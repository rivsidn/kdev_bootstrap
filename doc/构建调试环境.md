## 功能概述

能够方便、快捷的构建内核调试环境.

### 构建调试

#### 基本框架

```

                                    USER
                                     |
                                     v
                              +--------------+
                              | config files |
                              +--------------+
                                     |
                                     | kboot_build_bootfs
                                     v
                              +--------------+
                         +----|    bootfs    |----+
                         |    +--------------+    |
      kboot_build_docker |                        | kboot_build_qemu
                         |                        |
                         v                        v
                  +--------------+       +-----------------+
                  | docker image |       | qemu-rootfs.img |
                  +--------------+       +-----------------+

```

1. 用户设置[配置文件](配置文件.md)
2. 解析配置文件通过debootstrap 生成根文件系统
3. 通过根文件系统沟将docker 镜像(用于内核编译)
4. 通过根文件系统生成qemu-rootfs.img(用于内核调试)

#### 实现命令

| 命令               | 功能                                      |
|--------------------|-------------------------------------------|
| kboot_build_bootfs | 构建[根文件系统](根文件系统.md)           |
| kboot_build_docker | 构建[docker镜像](docker镜像.md)           |
| kboot_build_qemu   | 构建[qemu-rootfs.img](构建qemu-rootfs.md) |

#### 镜像命名规范

自动生成名称时候的命名规范.

| 命名规范                              | 说明                     |
|---------------------------------------|--------------------------|
| ubuntu-\${version}-${arch}            | docker 镜像命名规范      |
| ubuntu-\${version}-${arch}-rootfs.img | qemu-rootfs.img 命名规范 |

## 明确限制

- 仅支持ubuntu系统构建

## 附录

### 废弃设计

> ### 功能使用
> 
> 详见独立文档 [功能使用](功能使用.md).
> 
> #### 基本框架
> 
> ```
>                        +-----------------------------------+
>                        | ubuntu version/kernel version map |
>                        +-----------------------------------+
>                                        |
>                                        v
>                                +----------------+
>                        +-------| ubuntu version |-------+
>                        |       +----------------+       |
>                        |                                |
>                        v                                v
>                    +--------+                      +--------+
>                    | docker |                      |  qemu  |
>                    +--------+                      +--------+
> ```
> 
> 1. 通过环境变量设置要调试的内核版本
> 2. 通过解析ubuntu 版本与内核版本对照表选择对应的ubuntu 版本
> 3. 通过名称选择对应的docker 镜像和qemu-rootfs.img

这样会造成耦合，且将发行版限制在ubuntu.

